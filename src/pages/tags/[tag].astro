---
import { getCollection } from 'astro:content';
import { ARTICLE_TAGS } from '@/constants';
import BaseLayout from '@/layouts/BaseLayout.astro';

export const getStaticPaths = async () => {
  const allArticles = await getCollection('articles');

  return ARTICLE_TAGS.map((tag) => {
    const filteredArticles = allArticles.filter((article) =>
      article.data.tags?.includes(tag),
    );

    return {
      params: { tag },
      props: { articles: filteredArticles },
    };
  });
};

const { tag } = Astro.params;
const { articles } = Astro.props;

const title = `Articles tagged #${tag}`;
const description =
  'Articles, news, and tutorials on ' +
  'front-end development and programming by Dmitrii Sviridov ' +
  `tagged #${tag}.`;

const isEmpty = articles.length === 0;
---

<BaseLayout title={title} description={description}>
  <h1>Articles tagged #{tag}</h1>
  {
    isEmpty ? (
      <p>No articles found</p>
    ) : (
      <ul>
        {articles.map((article) => (
          <li>
            <a href={`/articles/${article.slug}`}>{article.data.title}</a>
          </li>
        ))}
      </ul>
    )
  }
</BaseLayout>
